# mysqldump

[![Build Status](https://secure.travis-ci.org/juniorsysadmin/puppet-mysqldump.png)](http://travis-ci.org/juniorsysadmin/puppet-mysqldump)

#### Table of Contents

1. [Overview](#overview)
2. [Usage](#usage)
3. [Limitations](#limitations)
4. [Development](#development)

## Overview

This module creates a simple shell script (called backup_mysql_databases.sh by
default) which performs a mysqldump of specified databases using the
`mysqldump::backup` defined type.

It is an alternative to the backup class `mysql::server::backup` used in the
puppetlabs-mysql module.

By default the shell script is placed in the folder
/var/scripts/backup-scripts . `script_dir` needs to exist.

The default `dump_root_dir` is /var/backup . It also needs to exist.

A subdirectory can optionally be passed to the shell script. This allows you
to output dumps to a specific directory depending on when the script gets
called.

For example:

```
/var/scripts/backup-scripts/backup_mysql_databases.sh weekly
```

This scripts uses MySQL user/password credentials listed in the .my.cnf file of
the executed user's home directory. The .my.cnf file will need to look
something like:

```
[mysqldump]
user=mysqluser
password=secret
```

## Usage

```puppet
class { '::mysqldump':
  dump_root_dir     => '/var/backup/other',
  mysqldump_options => '--routines',
}

mysqldump::backup { 'database1':
  dump_root_dir     => '/var/backup/sales',
  mysqldump_options => '--ignore-table=foo',
}

mysqldump::backup { 'database2': }
...
```

will result in:

```shell
#!/bin/sh
# backup_mysql_databases.sh
# This file was generated by Puppet

# MySQL credentials will be based off the .my.cnf file in the user's home
# directory

SUBDIRECTORY=""
TIMESTAMP=$(/bin/date +%F)

if [ -n "$1" ]; then
  SUBDIRECTORY="$1"
fi

# database1
/usr/bin/mysqldump --ignore-table=foo database1 | /bin/gzip > /var/backup/sales/$SUBDIRECTORY/database1-${TIMESTAMP}.sql.gz

# database2
/usr/bin/mysqldump --routines database2 | /bin/gzip > /var/backup/other/$SUBDIRECTORY/database2-${TIMESTAMP}.sql.gz
```

### Parameters

The following parameters are available in the mysqldump module:

#### `date_format`

The format options passed to the date command. Defaults to +%F

#### `date_path`

Path to the date command. Defaults to /bin/date

#### `dump_root_dir`

Where to put the MySQL dumps (if the script is invoked with no subdirectory
argument). Defaults to /var/backup

#### `gzip_path`

Path to the gzip command. Defaults to /bin/gzip

#### `mysqldump_options`

Options passed to mysqldump. Defaults to --routines

#### `mysqldump_path`

Path to the mysqldump command. Defaults to /usr/bin/mysqldump

#### `script_dir`

Where to put the shell script. Defaults to /var/scripts/backup_scripts

#### `script_file_group`

File group for the script. Defaults to root

#### `script_file_mode`

File mode for the script. Defaults to 0700

#### `script_file_name`

Name of the script. Defaults to backup_mysql_databases.sh

#### `script_file_owner`

File owner for the script. Defaults to root

## Limitations

This module has received limited testing on:

* CentOS/RHEL 6

against Puppet 3.x

## Development

Patches are welcome.
